<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments :: html_header}"></head>

<head>
    <title>Criar conta | Desapegaí</title>
</head>

<body>
    <div th:replace="~{fragments :: html_nav}"></div>
    <br /><br /><br />
    <div class="container">
        <div class="row col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h2 class="text-center">Criar conta</h2>
                </div>
                <div th:if="${param.success}">
                    <div class="alert alert-info">
                        Registrado com sucesso
                    </div>
                </div>
                <div class="card-body">
                    <form method="post" th:action="@{/register/save}" th:object="${user}">
                        <div class="form-group mb-3">
                            <label class="form-label">Email</label>
                            <input class="form-control" id="email" name="email" th:field="*{email}" type="email" />
                            <p th:errors="*{email}" class="text-danger" th:if="${#fields.hasErrors('email')}"></p>
                        </div>

                        <div class="form-group mb-3">
                            <label class="form-label">Nome de usuario</label>
                            <input class="form-control" id="username" name="username" th:field="*{username}" />
                            <p th:errors="*{username}" class="text-danger" th:if="${#fields.hasErrors('username')}"></p>
                        </div>

                        <div class="form-group mb-3">
                            <label class="form-label">Nome e Sobrenome</label>
                            <input class="form-control" id="name" name="name" th:field="*{name}" />
                            <p th:errors="*{name}" class="text-danger" th:if="${#fields.hasErrors('name')}"></p>
                        </div>

                        <div class="form-group mb-3">
                            <label class="form-label">Senha</label>
                            <input class="form-control" id="password" name="password" th:field="*{password}" type="password" />
                            <p th:errors="*{password}" class="text-danger" th:if="${#fields.hasErrors('password')}"></p>
                        </div>

                        <div class="form-group mb-3">
                            <label class="form-label">CEP:</label><br>
                            <input class="form-control" type="text" id="cep" name="cep" th:field="*{address}" onblur="pesquisacep(this.value);" placeholder="Digite o CEP auto preenchimento">
                        </div>
                        <div class="form-group mb-3">
                            <label class="form-label" for="rua">Rua:</label><br>
                            <input class="form-control" type="text" id="rua" name="rua" readonly>
                        </div>
                        <div class="form-group mb-3">
                            <label class="form-label" for="bairro">Bairro:</label><br>
                            <input class="form-control" type="text" id="bairro" name="bairro" readonly>
                        </div>
                        <div class="form-group mb-3">
                            <label class="form-label" for="cidade">Cidade:</label><br>
                            <input class="form-control" type="text" id="cidade" name="cidade" readonly>
                        </div>
                        <div class="form-group mb-3">
                            <label class="form-label">Telefone</label>
                            <input class="form-control" id="phone" name="phone" onblur="validarTelefone(this.value)" th:field="*{phone}" />
                            <p th:errors="*{phone}" class="text-danger" th:if="${#fields.hasErrors('phone')}"></p>
                        </div>

                        <div class="form-group text-center">
                            <button class="btn btn-primary ps-5 pe-5 mb-1" type="submit">Criar</button>
                            <br>
                            <span>Já tem uma conta? <a th:href="@{/login}">Entrar</a></span>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MfZyZ1OXnGCKJv3/JBfQckuP7rfrJpOVHjq8b8f+0Cj0A0bQswe5CkXZ2MI8jM2"
        crossorigin="anonymous"></script>

        <script>
    
            function limpa_formulário_cep() {
                    //Limpa valores do formulário de cep.
                    document.getElementById('rua').value=("");
                    document.getElementById('bairro').value=("");
                    document.getElementById('cidade').value=("");
            }
        
            function meu_callback(conteudo) {
                if (!("erro" in conteudo)) {
                    //Atualiza os campos com os valores.
                    document.getElementById('rua').value=(conteudo.logradouro);
                    document.getElementById('bairro').value=(conteudo.bairro);
                    document.getElementById('cidade').value=(conteudo.localidade);
                } //end if.
                else {
                    //CEP não Encontrado.
                    limpa_formulário_cep();
                    alert("CEP não encontrado.");
                }
            }
                
            function pesquisacep(valor) {
        
                //Nova variável "cep" somente com dígitos.
                var cep = valor.replace(/\D/g, '');
        
                //Verifica se campo cep possui valor informado.
                if (cep != "") {
        
                    //Expressão regular para validar o CEP.
                    var validacep = /^[0-9]{8}$/;
        
                    //Valida o formato do CEP.
                    if(validacep.test(cep)) {
        
                        //Preenche os campos com "..." enquanto consulta webservice.
                        document.getElementById('rua').value="...";
                        document.getElementById('bairro').value="...";
                        document.getElementById('cidade').value="...";
        
                        //Cria um elemento javascript.
                        var script = document.createElement('script');
        
                        //Sincroniza com o callback.
                        script.src = 'https://viacep.com.br/ws/'+ cep + '/json/?callback=meu_callback';
        
                        //Insere script no documento e carrega o conteúdo.
                        document.body.appendChild(script);
        
                    } //end if.
                    else {
                        //cep é inválido.
                        limpa_formulário_cep();
                        alert("Formato de CEP inválido.");
                    }
                } //end if.
                else {
                    //cep sem valor, limpa formulário.
                    limpa_formulário_cep();
                }
            };
        
            </script>

            <script>
                function validarTelefone(telefone) {
                    // Expressão regular mais flexível para aceitar diferentes formatos
                    var regex = /^[0-9]{10,11}$/;

                    if (!regex.test(telefone)) {
                        alert("Número de telefone inválido! Por favor, insira um número válido.");
                        document.getElementById('phone').value = "";  // Limpa o campo se for inválido
                    }
                }
            </script>
</body>

</html>
